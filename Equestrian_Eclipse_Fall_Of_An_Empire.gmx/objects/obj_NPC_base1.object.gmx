<!--This Document is generated by GameMaker, if you edit it by hand then you do so at your own risk!-->
<object>
  <spriteName>&lt;undefined&gt;</spriteName>
  <solid>0</solid>
  <visible>-1</visible>
  <depth>0</depth>
  <persistent>0</persistent>
  <parentName>obj_interactable</parentName>
  <maskName>&lt;undefined&gt;</maskName>
  <events>
    <event eventtype="0" enumb="0">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>///Setup

var hasquest = false;
quest_started = false;
quest_assigned = false;
search_quest = "";
search_item = "";
character = noone;

my_target = instance_create(x,y,obj_pathguide);
my_path = -1;

phy_fixed_rotation = true;
npc_base_prepare = false;   //If E was pressed -&gt; check if released

//Quest Messages

speech_active_counter = 0;

speaking = false;

quest_message = 1;

quest_message_1_1 = "test 1";
quest_message_1_2 = "test 2";
quest_message_1_3 = "test 3";
quest_message_1_4 = "test 4";
quest_message_1_5 = "test 5";

//Handle Text Loop

text_loop = 0;
text_loop_limit = 6;
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="3" enumb="0">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>///Depth

depth = y * -1;
</string>
          </argument>
        </arguments>
      </action>
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>///Interaction

with(obj_player)
{
    character = instance_nearest(x, y, obj_NPC_base1);
}

var dist = point_distance(obj_player.phy_position_x, obj_player.phy_position_y, character.x, character.y);

if(dist &lt; 50)
{
    if(hasquest == true)
    {
        //Quest start confirmed
        if(global.quest_success == 1)
        {
        if(global.quest_target == quest_name &amp;&amp; global.quest_b == true)
        {
            //Text
            with(instance_create(200, 520, obj_window_base))
            {
                image_xscale = 12;
                image_yscale = 3;
                window_message1 = other.quest_start;
                window_speaker = other.sprite;
                
                event_user(0);
            }
            //Avatar
            with(instance_create(0, 520, obj_window_base))
            {
                image_xscale = 3;
                image_yscale = 3;
                window_speaker = other.sprite;
                
                event_user(0);
            }
            //show_message(quest_start)
            
            global.message1 = "Quest started: " + quest_name + ".";
            global.message2 = true;
            show_debug_message("Quest activated: " + quest_name + ".");
        
            quest_object1.active = true;
            obj_player.quest_assigned = false;
            global.quest_b = false;
        
            quest_started = true;
        }
        }
            
        //Quest start prohibited
        if(global.quest_success == 2)
        {
        if(global.quest_target == quest_name &amp;&amp; global.quest_b == true)
        {
            //Text
            with(instance_create(200, 520, obj_window_base))
            {
                image_xscale = 12;
                image_yscale = 3;
                window_message1 = "Sorry, you already have enough quests.#Come back when you have finished some.";
                window_speaker = other.sprite;
                
                event_user(0);
            }
            //Avatar
            with(instance_create(0, 520, obj_window_base))
            {
                image_xscale = 3;
                image_yscale = 3;
                window_speaker = other.sprite;
                
                event_user(0);
            }
            
            obj_player.quest_assigned = false;
            global.quest_b = false;
        }
        }
    }
}
</string>
          </argument>
        </arguments>
      </action>
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>///E press

if(keyboard_check(ord("E")))
{
    npc_base_prepare = true;
    
}

if(keyboard_check_released(ord("E")))
{
if(npc_base_prepare == true)
{
npc_base_prepare = false;
var dist = point_distance(obj_player.phy_position_x, obj_player.phy_position_y,phy_position_x,phy_position_y);

if(dist &lt; 50)
{
    if(hasquest == true)
    {
        if(quest_started == false)
        {   
            var i = 0;
            while(search_quest != quest_name &amp;&amp; i &lt; 1) //Runs = 5
            {
                search_quest = global.quests[i,0];
                i += 1;
                show_debug_message("Search quests run " + string(i) + ".");
            }
            
            delete = i -1;
            
            //Quest already assigned -&gt; check if completed
            if(search_quest == quest_name)
            {
                show_debug_message("Quest found in quest database.");
                
                i = 0;
                while(search_item != quest_item_name &amp;&amp; i &lt; 25) //Runs = 25
                {
                    search_item = global.items[i,0];
                    i += 1;
                    show_debug_message("Search inventory run " + string(i) + ".");
                }
                
                //Quest completed
                if(search_item == quest_item_name)
                {
                    //Text
                    with(instance_create(200, 520, obj_window_base))
                    {
                        image_xscale = 12;
                        image_yscale = 3;
                        window_message1 = other.quest_success;
                        window_speaker = other.sprite;
                        
                        event_user(0);
                    }
                    //Avatar
                    with(instance_create(0, 520, obj_window_base))
                    {
                        image_xscale = 3;
                        image_yscale = 3;
                        window_speaker = other.sprite;
                        
                        event_user(0);
                    }
                    //show_message(quest_success)
                    
                    show_debug_message("Quest completed: " + quest_name + ".");
                    
                    i -= 1;
                    show_message("Item slot [" + string(i) + "] selected for deletion.");
                    global.items[i,0] = "";
                    global.items[i,1] = "";
                    global.items[i,2] = "";
                    global.items[i,3] = "";
                    global.items[i,4] = spr_none;
                    show_debug_message("Erasing item out of inventory successful.");
                    
                    show_message("Quest slot [" + string(delete) + "] selected for deletion.");
                    global.quests[delete,0] = "";
                    global.message1 = "Quest completed: " + quest_name + ".";
                    global.message2 = true;
                      
                    hasquest = false;
                }
                //Quest uncompleted
                else
                {
                    //Text
                    with(instance_create(200, 520, obj_window_base))
                    {
                        image_xscale = 12;
                        image_yscale = 3;
                        window_message1 = other.quest_uncompleted;
                        window_speaker = other.sprite;
                        
                        event_user(0);
                    }
                    //Avatar
                    with(instance_create(0, 520, obj_window_base))
                    {
                        image_xscale = 3;
                        image_yscale = 3;
                        window_speaker = other.sprite;
                        
                        event_user(0);
                    }
                    //show_message(quest_uncompleted);
                }
            }
            //Quest will be assigned
            else
            {
                show_debug_message("Quest not found in quest database.");
                
                if(global.quest_b == false)
                {
                    global.quest1 = quest_name;
                    
                    with(obj_player)
                    { 
                        inv_quest = 1;
                        event_user(0);
                    }
                    
                    show_debug_message("Quest setup preparation.");
                }
            }
        }
        else
        {
            quest_started = false;
        }
    }
    else
    {
        //No Quest can be given
        //Text
        with(instance_create(200, 520, obj_window_base))
        {
            image_xscale = 12;
            image_yscale = 3;
            event_user(1);
            window_message1 = other.quest_none;
            window_speaker = other.sprite;
            
            event_user(0);
        }
        //Avatar
        with(instance_create(0, 520, obj_window_base))
        {
            image_xscale = 3;
            image_yscale = 3;
            window_speaker = other.sprite;
            
            event_user(0);
        }
    //show_message(quest_none);
    }
}
}
}
</string>
          </argument>
        </arguments>
      </action>
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>///Follow path if available

if(my_path != -1)
{
    dir = point_direction(my_target.x, my_target.y, phy_position_x, phy_position_y);
    dist = point_distance(my_target.x, my_target.y, phy_position_x, phy_position_y);
    
    dx = lengthdir_x(1, dir);
    dy = lengthdir_y(1, dir);
    
    phy_position_x -= dx;
    phy_position_y -= dy;
    
    if(dist &gt; 32)
    {
        phy_position_x = my_target.x;
        phy_position_y = my_target.y;
    }
    
    if(dir &lt; 225 &amp;&amp; dir &lt; 315)
    {
        sprite_index = spr_derpy_left;
    }
    else
    {
        if(dir &lt; 135 &amp;&amp; dir &lt; 225)
        {
            sprite_index = spr_derpy_right;
        }
        else
        {
            if(dir &lt; 45 &amp;&amp; dir &lt; 135)
            {
                sprite_index = spr_derpy_down;
            }
            else
            {
                sprite_index = spr_derpy_up;
            }
        }
    }
}
</string>
          </argument>
        </arguments>
      </action>
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>///E pressed &amp; speaking

if(dist &lt; 50)
{
    if(hasquest = false)
    {
        if(keyboard_check(ord("E")))
        {
            speech_active_counter = 1;
            //show_debug_message("speech step 1");
        }
    
        if(speech_active_counter = 1)
        {
            if(keyboard_check_released(ord("E")))
            {
                speech_active_counter = 2;
                text_loop += 1;
                event_user(1);
                //show_debug_message("speech step 2");
            }
        }
    }
    else
    {
        text_loop = 0;
        speech_active_counter = 0;
    }
}

/*if(keyboard_check(ord("E")))
{
    if(speaking = false)
    {
    speaking = true;
    event_user(1);
    show_debug_message("The speech system has been activated");
    }
    if(speaking = true)
    {
    event_user(1);
    show_debug_message("Still working");
    }
}*/
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="4" ename="obj_obstacles">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>///Collide With
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="7" enumb="11">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>//Handle Quest 1

if(quest_message = 1)
{
    //Prepare window for deletion on "E" press
    if(text_loop = text_loop_limit - 1)
    {
        obj_window_base.destroy = true;
    }
    
    //Begin messages
    
    if(text_loop = text_loop_limit)
    {
        text_loop = 0;
        //speech_active_counter = 0;
        show_debug_message("end message");
    }
    
    if(text_loop = 1)
    {
        //Draw text box on first message
    
        with(instance_create(200, 520, obj_window_base))
        {
            image_xscale = 12;
            image_yscale = 3;
            window_message1 = other.quest_message_1_1;
            window_speaker = other.sprite;
            
            event_user(0);
        }
        //Draw avatar
    
        with(instance_create(0, 520, obj_window_base))
        {
            image_xscale = 3;
            image_yscale = 3;
            window_speaker = other.sprite;
              
            event_user(0);
        }
    
        //speech_active_counter = 0;
        draw_text(100,100,quest_message_1_1);
        show_debug_message("quest message 1")
    }
    
    if(text_loop = 2)
    {
        with(obj_window_base)
        {
            window_message1 = other.quest_message_1_2;
            event_user(0);
        }
        
        //speech_active_counter = 0;
        draw_text(100,100,quest_message_1_2);
        show_debug_message("quest message 2");
    }
    
    if(text_loop = 3)
    {
        with(obj_window_base)
        {
            window_message1 = other.quest_message_1_3;
            event_user(0);
        }
        
        //speech_active_counter = 0;
        draw_text(100,100,quest_message_1_3);
        show_debug_message("quest message 3");
    }
    
    if(text_loop = 4)
    {
        with(obj_window_base)
        {
            window_message1 = other.quest_message_1_4;
            event_user(0);
        }
        
        //speech_active_counter = 0;
        draw_text(100,100,quest_message_1_4);
        show_debug_message("quest message 4");
    }
    
    if(text_loop = 5)
    {
        with(obj_window_base)
        {
            window_message1 = other.quest_message_1_5;
            event_user(0);
        }
        
        //speech_active_counter = 0;
        draw_text(100,100,quest_message_1_5);
        show_debug_message("quest message 5");
    }
}
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="7" enumb="10">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>with(my_target)
{
    path_start(other.my_path, 1, 1, true);
}
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="8" enumb="0">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>///Physics Debug

physics_draw_debug();
draw_self();
</string>
          </argument>
        </arguments>
      </action>
    </event>
  </events>
  <PhysicsObject>-1</PhysicsObject>
  <PhysicsObjectSensor>0</PhysicsObjectSensor>
  <PhysicsObjectShape>0</PhysicsObjectShape>
  <PhysicsObjectDensity>0.100000001490116</PhysicsObjectDensity>
  <PhysicsObjectRestitution>0.100000001490116</PhysicsObjectRestitution>
  <PhysicsObjectGroup>0</PhysicsObjectGroup>
  <PhysicsObjectLinearDamping>0.100000001490116</PhysicsObjectLinearDamping>
  <PhysicsObjectAngularDamping>0.100000001490116</PhysicsObjectAngularDamping>
  <PhysicsObjectFriction>0.200000002980232</PhysicsObjectFriction>
  <PhysicsObjectAwake>-1</PhysicsObjectAwake>
  <PhysicsObjectKinematic>0</PhysicsObjectKinematic>
  <PhysicsShapePoints>
    <point>24.75,25.75</point>
    <point>18,25</point>
  </PhysicsShapePoints>
</object>
